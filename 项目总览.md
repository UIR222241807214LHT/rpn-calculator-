# 🔧 一、项目目标总览

## 🧩 基础版本（优先完成）

* 支持四则运算的逆波兰表达式计算（如：`3 4 + 2 *` ➜ 14）
* 基于 **堆栈（stack）** 实现表达式求值

## 📐 中级版本（扩展功能）

* 增加对 `sin`, `cos`, `tan`, `log` 等常见单目运算符的支持
* 增加错误处理（非法字符、栈空、除以0等）
* 支持浮点数（double）

## 🧠 高级版本（自定义运算符 & 网络爬虫）

* 添加自定义运算符 `$()`，用于美元→人民币转换
* 抓取新浪财经的美元对人民币汇率
* 实现自己的 HTTP 客户端：直接使用 socket + HTTP 协议解析响应

---

# 🗺️ 二、任务路线图

## 🔹 第1阶段：基础逆波兰计算器（四则运算）

1. **输入格式**：

   * 支持用户从命令行输入一个逆波兰表达式，例如：

     ```
     输入: 3 4 + 2 *   → 输出: 14
     ```

2. **使用栈实现逆波兰表达式求值**：

   * 遇到数字就压栈
   * 遇到操作符就弹出两个操作数，进行计算后压回栈中

3. **实现代码模块**：

   * `evaluate_rpn(std::vector<std::string>& tokens)`：输入表达式 token 序列，返回结果

---

## 🔹 第2阶段：扩展支持单目运算符

1. 修改栈处理逻辑：支持判断操作符是 **单目（1个操作数）** 还是 **双目（2个操作数）**

2. 添加支持的函数：

   * `sin x` ➜ `x sin` 形式，如 `3.1415926 sin` → 0
   * 使用 `std::sin`、`std::cos`、`std::log` 等 C++ 标准库函数（`<cmath>`）

3. 增加输入验证 & 错误提示

---

## 🔹 第3阶段：自定义运算符 \$（美元转换为人民币）

1. **新增表达式形式**：

   * `100 $` 表示将 100 美元按当前汇率转换成人民币

2. 实现方式：

   * `$` 运算符调用汇率获取模块（初始阶段可用写死的汇率）

---

## 🔹 第4阶段：联网爬取汇率（不使用库，直接实现HTTP客户端）

1. 使用 **Socket + HTTP协议** 实现一个最基本的 HTTP GET 请求

   * 目标汇率网站，如：

     ```
     http://open.er-api.com/v6/latest/USD
     ```

2. 处理步骤：

   * 使用 C++ 的 `socket()` / `connect()` / `send()` / `recv()` API

   * 手动构造 HTTP 请求报文，如：

     ```http
     GET /v6/latest/USD HTTP/1.1
     Host: open.er-api.com
     Connection: close
     ```

   * 解析 HTML 响应提取汇率字段（可以使用正则或简单字符串查找）

---

# 🧱 三、代码结构建议

```
rpn_calculator/
├── main.cpp # 主程序
├── rpn_evaluator.h/.cpp # 表达式解析与执行
├── math_functions.h/.cpp # sin, cos 等函数支持
├── exchange_rate.h/.cpp # 汇率获取模块
├── http_client.h/.cpp # HTTP 客户端 socket 实现
├── utils.h/.cpp # 字符串处理、token 分割等工具函数
```

---

# 📌 四、开发建议

* 使用 VSCode 的 `tasks.json` + `g++` 配置编译多个 `.cpp` 文件
* 使用 `std::stack` 管理操作数
* 使用 `std::map<std::string, std::function<double(std::vector<double>)>>` 来映射操作符到函数
* 写测试用例：输入表达式 + 预期输出，方便逐步验证

---

# ✨ 示例表达式支持（完整版本）

| 表达式输入  | 说明                         | 输出（假设汇率为7.2） |
| ----------- | ---------------------------- | --------------------- |
| `3 4 +`     | 3 + 4                        | 7                     |
| `3 4 + 2 *` | (3 + 4) * 2                  | 14                    |
| `90 sin`    | sin(90°)，需转弯处理（可选） | 1（或近似）           |
| `100 $()`   | 100美元转人民币              | 720                   |

---

# 🔚 总结

这个项目从基本的数据结构和算法训练出发，逐步拓展到函数编程、模块化设计、网络通信、协议解析，非常适合作为一个进阶 C++ 项目：

* **基础打牢**：栈、字符串解析、表达式处理  
* **能力提升**：函数扩展、错误处理、模块分离  
* **技术拓展**：网络协议实现、网页数据提取、动态数据接入
